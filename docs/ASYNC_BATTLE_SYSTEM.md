# 非同期対戦システム設計書 (Phase 1)

## 1. 基本方針

本ドキュメントは、AshenhallプロジェクトのPhase 1における「非同期対戦システム」の実装計画を定める。
プロジェクト戦略に基づき、以下の原則を最優先する。

- **個人開発の持続可能性**: 学習コストと保守性を最小限に抑える。
- **コスト効率**: Vercelの無料枠内で運用可能な技術を選定する。
- **段階的実装**: Phase 1で必要な最小限の機能に絞る。

## 2. アーキテクチャ方針

- **サーバーレス**: 運用コストと保守性を考慮し、サーバーレスアーキテクチャを基本方針とする。
- **技術スタック**: フロントエンドと親和性の高いNext.js/Vercelエコシステムを最大限活用し、学習コストを抑える。
- **データ管理**: ユーザー情報、デッキ、対戦履歴などを管理するための永続化層を設ける。
- **非同期処理**: 対戦申請はキューイングシステムで管理し、バックグラウンドの定期処理でマッチングと戦闘を実行する。

## 3. 主要な責務

- **認証**: プレイヤーを識別し、セキュアなデータアクセスを提供する。
- **データ永続化**: ユーザー、デッキ、対戦結果、リプレイログなどを保存する。
- **API**: フロントエンドとバックエンド処理を接続するインターフェース。
- **マッチング**: 対戦希望者をキューで管理し、適切な相手を組み合わせる。
- **戦闘実行**: サーバーサイドで決定論的な戦闘エンジンを実行し、結果を記録する。

## 4. 開発の方向性

具体的な実装技術やライブラリの選定は、各機能の開発着手時点での最新情報とプロジェクトの制約を元に決定する。本ドキュメントは、実装の詳細ではなく、システムが満たすべき要件と責務を定義するものである。

## 5. リスクと対策

- **決定論の担保**: サーバーサイドで戦闘エンジンを実行する際、乱数生成には必ずシード値を使用し、外部状態（現在時刻など）に依存しないことを徹底する。
- **Vercel無料枠の制限**: Cron Jobの実行頻度やDBの書き込み頻度を監視し、必要に応じて最適化や有料プランへの移行を検討する。
